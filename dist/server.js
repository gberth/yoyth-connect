globalThis.IMBA_MANIFEST={"entry:src/app/yoyth-connect.imba?web":{"url":"./assets/yoyth-connect.6WUSDKJV.js","path":"/home/gunnar/yoyth/yoyth-connect/dist/public/assets/yoyth-connect.6WUSDKJV.js"},"*?css":{"url":"./assets/index.LXIC4F6Z.css","path":"/home/gunnar/yoyth/yoyth-connect/dist/public/assets/index.LXIC4F6Z.css"},"./assets/yoyth-connect.6WUSDKJV.js":{},"./assets/yoyth-connect.JFINNC2W.css":{},"./assets/index.LXIC4F6Z.css":{}};globalThis.IMBA_ASSETS_PATH='assets'
var re=Object.create;var D=Object.defineProperty;var se=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var ie=Object.getPrototypeOf,oe=Object.prototype.hasOwnProperty;var ae=(s,e,t,r)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ne(e))!oe.call(s,n)&&n!==t&&D(s,n,{get:()=>e[n],enumerable:!(r=se(e,n))||r.enumerable});return s};var m=(s,e,t)=>(t=s!=null?re(ie(s)):{},ae(e||!s||!s.__esModule?D(t,"default",{value:s,enumerable:!0}):t,s));var $=require("path");var ye=require("cluster"),h=m(require("fs")),f=m(require("path")),K=require("events"),W=m(require("http")),ve=require("https");function c(s){let e;return s&&((e=s.toIterable)?e.call(s):s)}function _(s,e){Object.defineProperty(s,"name",{value:e,configurable:!0})}function k(s){var e,t;(t=(e=Object.getPrototypeOf(s.prototype).constructor)==null?void 0:e.inherited)==null||t.call(e,s)}var le=Symbol.for("#setup"),L=Symbol.for("#setup?"),ce=Symbol.for("#dom"),he=Symbol.for("#server"),q={html:{"Content-Type":"text/html; charset=utf-8"},js:{"Content-Type":"text/javascript; charset=utf-8"},cjs:{"Content-Type":"text/javascript; charset=utf-8"},mjs:{"Content-Type":"text/javascript; charset=utf-8"},json:{"Content-Type":"application/json; charset=utf-8"},css:{"Content-Type":"text/css; charset=utf-8"},map:{"Content-Type":"application/json; charset=utf-8"},otf:{"Content-Type":"font/otf"},ttf:{"Content-Type":"font/ttf"},woff:{"Content-Type":"font/woff"},woff2:{"Content-Type":"font/woff2"},svg:{"Content-Type":"image/svg+xml"},avif:{"Content-Type":"image/avif"},gif:{"Content-Type":"image/gif"},png:{"Content-Type":"image/png"},apng:{"Content-Type":"image/apng"},webp:{"Content-Type":"image/webp"},jpg:{"Content-Type":"image/jpeg"},jpeg:{"Content-Type":"image/jpeg"},ico:{"Content-Type":"image/x-icon"},bmp:{"Content-Type":"image/bmp"},pdf:{"Content-Type":"application/pdf"},webm:{"Content-Type":"video/webm"},weba:{"Content-Type":"audio/webm"},avi:{"Content-Type":"video/x-msvideo"},mp3:{"Content-Type":"audio/mpeg"},mp4:{"Content-Type":"video/mp4"},m4a:{"Content-Type":"audio/m4a"},mov:{"Content-Type":"video/quicktime"},wmv:{"Content-Type":"video/x-ms-wmv"},mpeg:{"Content-Type":"video/mpeg"},wav:{"Content-Type":"audio/wav"},ogg:{"Content-Type":"audio/ogg"},ogv:{"Content-Type":"video/ogg"},oga:{"Content-Type":"audio/ogg"},opus:{"Content-Type":"audio/opus"}},l=globalThis.process,b=class extends Set{call(e,...t){var r;r=[];for(let n of c(this))r.push(n[e](...t));return r}close(e={}){var t;t=[];for(let r of c(this))t.push(r.close(e));return t}reload(e={}){var t;t=[];for(let r of c(this))t.push(r.reload(e));return t}broadcast(e,...t){var r;r=[];for(let n of c(this))r.push(n.broadcast(e,...t));return r}emit(e,t){var r;r=[];for(let n of c(this))r.push(n.emit(e,t));return r}},I=b;(()=>{_(b,"Servers"),k(b)})();var v=new I,g,_e=new(g=class extends K.EventEmitter{constructor(){var e;super(...arguments),e=this,this.autoreload=!1,this.state={}}[le](){var e=this;if(this[L]!=!0&&(this[L]=!0,!0))return this.on("rebuild",function(t){let r=globalThis.IMBA_MANIFEST;return globalThis.IMBA_MANIFEST=t,v.broadcast("rebuild",t)}),this.on("reloading",function(t){var r;e.state.reloading=!0,r=[];for(let n of c(v))r.push(n.pause());return r}),this.on("reloaded",async function(t){var r;e.state.reloaded=!0,v.broadcast("reloaded"),await new Promise(function(o){return setTimeout(o,100)}),r=[];for(let o of c(v))r.push(o.close());let n=r;return setTimeout(function(){return l.exit(0)},100),await Promise.all(n),l.exit(0)}),!0}send(e){if(l.send instanceof Function)return l.send(e)}on(e,t){return super.on(...arguments)}reload(){if(!(this.isReloading!=!0&&(this.isReloading=!0,!0)))return this;if(this.state.reloading=!0,!l.env.IMBA_SERVE){console.warn("not possible to gracefully reload servers not started via imba start");return}this.send("reload")}},(()=>{_(g,"Process"),k(g)})(),g);function J(s,e=[],t=0){let r=globalThis.IMBA_MANIFEST[s];if(e.indexOf(s)>=0)return e;if(r!=null&&r.imports)for(let n=0,o=c(r==null?void 0:r.imports),a=o.length;n<a;n++){let i=o[n];e.push(i),J(i,e,t+1)}return e}var B=class{constructor(e,t,r={}){this.server=e,this.url=t,[this.pathname,this.query]=t.split("?"),this.ext=f.default.extname(this.pathname),this.headers={"Content-Type":"text/plain","Access-Control-Allow-Origin":"*","cache-control":"public, max-age=31536000"},Object.assign(this.headers,e.options.assetHeaders||{}),Object.assign(this.headers,q[this.ext.slice(1)]||{}),this.headers["max-age"]=864e5,r.imports&&e.options.preload!==!1&&(this.headers.Link=J(t).map(function(n){return"<"+n+">; rel=modulepreload; as=script"}).join(", ")),this.path=e.localPathForUrl(t)}respond(e,t){var r=this;return h.default.access(this.path,h.default.constants.R_OK,function(n){if(n)return t.writeHead(404,{}),t.end();try{if(r.server.options.setHeaders&&r.server.options.setHeaders(t,r.path),globalThis.BUN)return h.default.readFile(r.path,function(o,a){return t.writeHead(200,r.headers),t.end(a)});{let o=h.default.createReadStream(r.path);return t.writeHead(200,r.headers),o.pipe(t)}}catch{return t.writeHead(503,{}),t.end()}})}createReadStream(){return h.default.createReadStream(this.path)}pipe(e){return this.createReadStream().pipe(e)}},R=B;(()=>{_(B,"AssetResponder")})();var H=class{static wrap(e,t={}){return new this(e,t)}localPathForUrl(e){var o;let t,r,n=e.replace(/\?.*$/,"");return(o=this.urlToLocalPathMap)[n]??(o[n]=(t=f.default.resolve(this.publicPath,"."+n),r=h.default.existsSync(t)&&t,!r&&this.staticDir&&(t=f.default.resolve(this.staticDir,"."+n),r=h.default.existsSync(t)&&t),r))}headersForAsset(e){let t,r=f.default.extname(e);return t=Object.assign({"Content-Type":"text/plain","Access-Control-Allow-Origin":"*","cache-control":"public"},q[r.slice(1)]||{})}get manifest(){return globalThis.IMBA_MANIFEST||{}}constructor(e,t={}){var r=this;v.add(this),this.id=Math.random(),this.options=t,this.closed=!1,this.paused=!1,this.server=e,this.clients=new Set,this.stalledResponses=[],this.assetResponders={},this.urlToLocalPathMap={},this.publicExistsMap={};try{this.rootDir=l.env.IMBA_OUTDIR||f.default.dirname(l.env.pm_exec_path||l.argv[1])}catch{}try{this.publicPath=f.default.resolve(this.rootDir,l.env.IMBA_PUBDIR||globalThis.IMBA_PUBDIR||"public")}catch{}this.staticDir=globalThis.IMBA_STATICDIR||"",l.env.IMBA_PATH&&(this.devtoolsPath=f.default.resolve(l.env.IMBA_PATH,"dist","hmr.js")),this.scheme=e instanceof W.default.Server?"http":"https";let n=this.server._events.request,o=globalThis[ce];e.off("request",n),n[he]=this,e.on("listening",function(){let a=r.server.address(),i=a.address;(i=="::"||i=="0.0.0.0")&&(i="localhost");let d=""+r.scheme+"://"+i+":"+a.port+"/";if(!l.env.IMBA_CLUSTER)return console.log("listening on "+d)}),this.handler=function(a,i){var U;let d,A=a.constructor.name=="Http2ServerRequest",p=a.url;if(r.paused||r.closed)return i.statusCode=302,i.setHeader("Location",a.url),A||i.setHeader("Connection","close"),r.closed?(A&&a.stream.session.close(),i.end()):r.stalledResponses.push(i);let S=a.headers,M;A?M=S[":scheme"]+"://"+S[":authority"]:M=(a.connection.encrypted?"https":"http")+"://"+S.host;let N=r.manifest[p];if(N&&r.localPathForUrl(p))return((U=r.assetResponders)[p]||(U[p]=new R(r,p,N))).respond(a,i);if((p.match(/\.[A-Z\d]{8}\./)||p.match(/\.\w{1,4}($|\?)/))&&(d=r.localPathForUrl(p)))try{let u=r.headersForAsset(d);if(t.setHeaders&&t.setHeaders(i,d),globalThis.BUN)return h.default.readFile(d,function(T,te){return T?(i.writeHead(500,{}),i.write("Error getting the file: "+T)):(i.writeHead(200,u),i.end(te))});{let T=h.default.createReadStream(d);return i.writeHead(200,u),T.pipe(i)}}catch{return i.writeHead(503,{}),i.end()}if(o){let u=new o.Location(a.url,M);return o.Document.create({location:u},function(){return n(a,i)})}else return n(a,i)},e.on("request",this.handler),e.on("close",function(){return console.log("server is closing!!!")})}broadcast(e,t={},r=this.clients){t=JSON.stringify(t);let n="data: "+t+`


`;for(let o of c(r))o.write("event: "+e+`
`),o.write(`id: imba
`),o.write(n);return this}pause(){return this.paused!=!0&&(this.paused=!0,!0)&&this.broadcast("paused"),this}resume(){if(this.paused!=!1&&(this.paused=!1,!0))return this.broadcast("resumed"),this.flushStalledResponses()}flushStalledResponses(){for(let e=0,t=c(this.stalledResponses),r=t.length;e<r;e++)t[e].end();return this.stalledResponses=[]}close(){var e=this;return this.pause(),new Promise(function(t){return e.closed=!0,e.server.close(t),e.flushStalledResponses()})}},j=H;(()=>{_(H,"Server")})();function V(s,...e){return j.wrap(s,...e)}var x=m(require("express")),ee=m(require("path"));var Z=m(require("fs"));function pe(s){let e;return s&&((e=s.toIterable)?e.call(s):s)}function Y(s,e){Object.defineProperty(s,"name",{value:e,configurable:!0})}function ue(s,e,t=[""]){for(let r=0,n=pe(t),o=n.length;r<o;r++){let a=n[r],i=s.indexOf(a);if(i>=0)return s.slice(0,i)+e+s.slice(i)}return s}var F=class{constructor(e){this.src=e}get entry(){var e;return(e=globalThis.IMBA_MANIFEST)==null?void 0:e[this.src]}get url(){return this.entry?this.entry.url:this.src}get path(){return this.entry?this.entry.path:null}get body(){return this.path?Z.default.readFileSync(this.path,"utf-8"):null}toString(){return this.url}},w=F;(()=>{Y(F,"ImbaAsset")})();function C(s){var t;let e;return(e=(t=globalThis.IMBA_MANIFEST)==null?void 0:t[s])?new w(s):s}var E=class{constructor(e,t){this.text=e,this.refs=t}get body(){var e=this;let t=this.text.replace(/ASSET_REF_(\d+)/g,function(r,n){var i;let o,a=e.refs[n];return a instanceof w?String(a):(o=(i=globalThis.IMBA_MANIFEST)==null?void 0:i[String(a)])?o.url:a});return globalThis.IMBA_HMR_PATH&&(t=ue(t,"<script src='/__hmr__.js'><\/script>",["<!--$head$-->","<!--$body$-->","<html",""])),t}toString(){return this.body}},P=E;(()=>{Y(E,"HtmlAsset")})();function z(s,e){return new P(s,e)}var G=C("*?css");var Q=C("entry:src/app/yoyth-connect.imba?web");var fe=[G,Q],X=z(`<html lang="en">

<head><!--$head$-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300" rel="stylesheet" />

    <title>Yoyth Connect</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <!-- reference to the client script styles -->
    <link rel='stylesheet' href='ASSET_REF_0'>
</head>

<body><!--$body$-->
    <!-- reference to the client script -->
    <script type="module" src='ASSET_REF_1'><\/script>
</body>

</html>`,fe);var O={count:0},y=(0,x.default)(),de=process.env.PORT||3e3,me=x.default.json({limit:"1kb"});y.use("/v1/",x.default.static(ee.default.join((0,$.dirname)((0,$.resolve)("src/server.imba")),"../dist/public")));y.post("/increment",me,function(s,e){return O.count+=s.body.increment,e.send({count:O.count})});y.get("/count",function(s,e){return e.send({count:O.count})});y.get("/yoyth-connect/apiadmin/ping",function(s,e){return e.send({ping:"OK"})});y.get(/.*/,function(s,e){return s.accepts(["image/*","html"])!="html"?e.sendStatus(404):e.send(X.body)});V(y.listen(de));
//__FOOT__
