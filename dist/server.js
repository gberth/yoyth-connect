globalThis.IMBA_MANIFEST={"entry:src/app/yoyth-connect.imba?web":{"url":"./assets/yoyth-connect.KNPANIWV.js","path":"/home/gunnar/yoyth/yoyth-connect/dist/public/assets/yoyth-connect.KNPANIWV.js"},"*?css":{"url":"./assets/index.ZO0TXT2U.css","path":"/home/gunnar/yoyth/yoyth-connect/dist/public/assets/index.ZO0TXT2U.css"},"./assets/yoyth-connect.KNPANIWV.js":{},"./assets/yoyth-connect.QEFWBTMF.css":{},"./assets/index.ZO0TXT2U.css":{}};globalThis.IMBA_ASSETS_PATH='assets'
var ht=Object.create;var Oe=Object.defineProperty;var mt=Object.getOwnPropertyDescriptor;var gt=Object.getOwnPropertyNames;var _t=Object.getPrototypeOf,yt=Object.prototype.hasOwnProperty;var vt=(t,e,n,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let o of gt(e))!yt.call(t,o)&&o!==n&&Oe(t,o,{get:()=>e[o],enumerable:!(s=mt(e,o))||s.enumerable});return t};var m=(t,e,n)=>(n=t!=null?ht(_t(t)):{},vt(e||!t||!t.__esModule?Oe(n,"default",{value:t,enumerable:!0}):n,t));var R=Symbol.for("#__init__"),Tt=Symbol.for("#__initor__");var St=Symbol.for("#meta"),se=Symbol.for("imba");var gn={SUPERCALLS:1<<3,CONSTRUCTOR:1<<4},V={IsExtension:1<<0,IsTag:1<<1,HasDescriptors:1<<2,HasSuperCalls:1<<3,HasConstructor:1<<4,HasFields:1<<5,HasMixins:1<<6,HasInitor:1<<7,HasDecorators:1<<8,IsObjectExtension:1<<9},$=new Map,bt=globalThis[se]||(globalThis[se]={counter:0,classes:$});function H(t,e={}){var n;return $.has(t)||$.set(t,{symbol:Symbol(),parent:(n=Object.getPrototypeOf(t.prototype))==null?void 0:n.constructor,for:t,uses:[],inits:[],id:bt.counter++,...e}),$.get(t)}function oe(t){var e;return((e=t==null?void 0:t.toIterable)==null?void 0:e.call(t))||t}function wt(t,e){if(!t||!e)return!1;if(t.get)return e.get===t.get;if(t.set)return e.set===t.set;if(t.value)return t.value===e.value}function Ce(t,e,n){let s=t.constructor;n??(n=Object.getOwnPropertyDescriptors(e));let o=Object.getOwnPropertyDescriptors(t);delete n.constructor,n[R]&&delete n[R],Object.defineProperties(t,n);let r=H(s);if(r&&r.augments)for(let l of r.augments){let a=Object.getOwnPropertyDescriptors(l.prototype),c={};for(let u of Object.keys(n)){let f=n[u];a[u]&&!wt(o[u],a[u])?console.warn("wont extend",u):c[u]=f}Object.keys(c).length&&Ce(l.prototype,null,c)}return t}function Ae(t,e){let n=H(t),s=H(e);if(s.parent&&!(t.prototype instanceof s.parent))throw new Error(`Mixin ${e.name} has superclass not present in target class`);if(!s.augments){s.augments=new Set;let r=s.ref=Symbol(),l=Object[Symbol.hasInstance];e.prototype[r]=!0,Object.defineProperty(e,Symbol.hasInstance,{value:function(a){return this===e?a&&!!a[r]:l.call(this,a)}})}if(t.prototype[s.ref])return t;for(let r of s.uses)Ae(t,r,n);s.augments.add(t),n.uses.push(e);let o=Object.getOwnPropertyDescriptors(e.prototype);delete o.constructor,o[R]&&(n.inits.push(e.prototype[R]),delete o[R]),Object.defineProperties(t.prototype,o);try{n.top.version++}catch{}return t}var b={cache:{},self:null,target:null,proxy:new Proxy({},{apply:(t,e,...n)=>b.target[e].apply(b.self,n),get:(t,e)=>Reflect.get(b.target,e,b.self),set:(t,e,n,s)=>Reflect.set(b.target,e,n,b.self)})};function p(t,e,n,s,o=null){var u,f;let r=Object.getPrototypeOf(t.prototype);if(s&V.HasMixins&&($.set(t,$.get(r.constructor)),r=Object.getPrototypeOf(r)),o){let d=s&V.IsObjectExtension?o:o.prototype,I=H(t);if((u=I.uses)!=null&&u.length){o===d&&console.warn("Cannot extend object with mixins");for(let L of I.uses)Ae(o,L)}return s&V.HasSuperCalls&&(b.cache[e]=Object.create(Object.getPrototypeOf(d),Object.getOwnPropertyDescriptors(d))),Ce(d,t.prototype),o}let a=r==null?void 0:r.constructor,c=H(t,{symbol:e});if(Object.defineProperty(t,St,{value:c,enumerable:!1,configurable:!0}),n&&t.name!==n&&Object.defineProperty(t,"name",{value:n,configurable:!0}),c.flags=s,s&V.HasConstructor&&(t.prototype[Tt]=e),c.uses)for(let d of c.uses)(f=d.mixes)==null||f.call(d,t);return(a==null?void 0:a.inherited)instanceof Function&&a.inherited(t),t}var S=require("path");function re(t,e){var n;return typeof e=="string"?typeof t===e:(n=e[Symbol.hasInstance])==null?void 0:n.call(e,t)}function xt(t){let e;return t&&((e=t.toIterable)?e.call(t):t)}var Ye=Symbol.for("#__init__"),Ee=Symbol.for("#schedule"),ie=Symbol.for("#frames"),W=Symbol.for("#interval"),O=Symbol.for("#stage"),C=Symbol.for("#scheduled"),J=Symbol.for("#version"),It=Symbol.for("#fps"),ke=Symbol.for("#ticker"),$t=globalThis.requestAnimationFrame||function(t){return globalThis.setTimeout(t,1e3/60)};var vn=1/60,Ot=Symbol(),ce=class{constructor(e=null){this[Ye](e)}[Ye](e=null,n=!0,s=!0){var o;this.owner=e&&(o=e.owner)!==void 0?o:null,this.target=e&&(o=e.target)!==void 0?o:null,this.active=e&&(o=e.active)!==void 0?o:!1,this.value=e&&(o=e.value)!==void 0?o:void 0,this.skip=e&&(o=e.skip)!==void 0?o:0,this.last=e&&(o=e.last)!==void 0?o:0}tick(e,n){return this.last=this.owner[ie],this.target.tick(this,n),1}update(e,n){let s=this.active,o=e.value;return this.value!=o&&(this.deactivate(),this.value=o),(this.value||s||n)&&this.activate(),this}queue(){this.owner.add(this)}activate(){return this.value===!0?this.owner.on("commit",this):this.value===!1||typeof this.value=="number"&&(this.value/16.666666666666668<=2?this.owner.on("raf",this):this[W]=globalThis.setInterval(this.queue.bind(this),this.value)),this.active=!0,this}deactivate(){return this.value===!0&&this.owner.un("commit",this),this.owner.un("raf",this),this[W]&&(globalThis.clearInterval(this[W]),this[W]=null),this.active=!1,this}},ae=ce;(()=>{p(ce,Ot,"Scheduled",16)})();var Ct=Symbol(),ue=class{constructor(){var e=this;this.id=Symbol(),this.queue=[],this.stage=-1,this[O]=-1,this[ie]=0,this[C]=!1,this[J]=0,this.listeners={},this.intervals={},this.commit=function(){return e.add("commit"),e},this[It]=0,this.$promise=null,this.$resolve=null,this[ke]=function(n){return e[C]=!1,e.tick(n)}}touch(){return this[J]++}get version(){return this[J]}add(e,n){return(n||this.queue.indexOf(e)==-1)&&this.queue.push(e),this[C]||this[Ee](),this}get committingΦ(){return this.queue.indexOf("commit")>=0}get syncingΦ(){return this[O]==1}listen(e,n){let s=this.listeners[e],o=!s;return s||(s=this.listeners[e]=new Set),s.add(n),e=="raf"&&o&&this.add("raf"),this}unlisten(e,n){var s;let o=this.listeners[e];return o&&o.delete(n),e=="raf"&&o&&o.size==0&&(s=this.listeners.raf,delete this.listeners.raf),this}on(e,n){return this.listen(e,n)}un(e,n){return this.unlisten(e,n)}get promise(){var e=this;return this.$promise||(this.$promise=new Promise(function(n){return e.$resolve=n}))}tick(e){var n=this;let s=this.queue,o=this[ie]++;if(this.ts||(this.ts=e),this.dt=e-this.ts,this.ts=e,this.queue=[],this[O]=1,this[J]++,s.length)for(let r=0,l=xt(s),a=l.length;r<a;r++){let c=l[r];typeof c=="string"&&this.listeners[c]?this.listeners[c].forEach(function(u){if(re(u.tick,Function))return u.tick(n,c);if(re(u,Function))return u(n,c)}):re(c,Function)?c(this.dt,this):c.tick&&c.tick(this.dt,this)}return this[O]=this[C]?0:-1,this.$promise&&(this.$resolve(this),this.$promise=this.$resolve=null),this.listeners.raf&&this.add("raf"),this}[Ee](){return this[C]||(this[C]=!0,this[O]==-1&&(this[O]=0),$t(this[ke])),this}schedule(e,n){var o,r;return n||(n=e[o=this.id]||(e[o]={value:!0})),(n[r=this.id]||(n[r]=new ae({owner:this,target:e}))).update(n,!0)}unschedule(e,n={}){n||(n=e[this.id]);let s=n&&n[this.id];return s&&s.active&&s.deactivate(),this}},le=ue;(()=>{p(ue,Ct,"Scheduler",16)})();var At=new le;function v(){return At.add("commit").promise}function Yt(t,e){return globalThis.setTimeout(function(){t(),v()},e)}function Et(t,e){return globalThis.setInterval(function(){t(),v()},e)}var kt=globalThis.clearInterval,Rt=globalThis.clearTimeout,P=globalThis.imba||(globalThis.imba={});P.commit=v;P.setTimeout=Yt;P.setInterval=Et;P.clearInterval=kt;P.clearTimeout=Rt;var xn=require("cluster"),_=m(require("fs")),A=m(require("path")),De=require("events");var fe=m(require("path")),Ht=Symbol(),D,Re=new(D=class{get rootDir(){return process.env.IMBA_OUTDIR||fe.default.dirname(process.env.pm_exec_path||process.argv[1])}get publicPath(){return fe.default.resolve(this.rootDir,process.env.IMBA_PUBDIR||globalThis.IMBA_PUBDIR||"public")}},(()=>{p(D,Ht,"Env",0)})(),D);var Me=m(require("http")),On=require("https");function g(t){let e;return t&&((e=t.toIterable)?e.call(t):t)}function Pe(t,e){var n;return typeof e=="string"?typeof t===e:(n=e[Symbol.hasInstance])==null?void 0:n.call(e,t)}var Pt=Symbol.for("#setup"),He=Symbol.for("#setup?"),Dt=Symbol.for("#dom"),Mt=Symbol.for("#server"),Ne={html:{"Content-Type":"text/html; charset=utf-8"},js:{"Content-Type":"text/javascript; charset=utf-8"},cjs:{"Content-Type":"text/javascript; charset=utf-8"},mjs:{"Content-Type":"text/javascript; charset=utf-8"},json:{"Content-Type":"application/json; charset=utf-8"},css:{"Content-Type":"text/css; charset=utf-8"},map:{"Content-Type":"application/json; charset=utf-8"},otf:{"Content-Type":"font/otf"},ttf:{"Content-Type":"font/ttf"},woff:{"Content-Type":"font/woff"},woff2:{"Content-Type":"font/woff2"},svg:{"Content-Type":"image/svg+xml"},avif:{"Content-Type":"image/avif"},gif:{"Content-Type":"image/gif"},png:{"Content-Type":"image/png"},apng:{"Content-Type":"image/apng"},webp:{"Content-Type":"image/webp"},jpg:{"Content-Type":"image/jpeg"},jpeg:{"Content-Type":"image/jpeg"},ico:{"Content-Type":"image/x-icon"},bmp:{"Content-Type":"image/bmp"},pdf:{"Content-Type":"application/pdf"},webm:{"Content-Type":"video/webm"},weba:{"Content-Type":"audio/webm"},avi:{"Content-Type":"video/x-msvideo"},mp3:{"Content-Type":"audio/mpeg"},mp4:{"Content-Type":"video/mp4"},m4a:{"Content-Type":"audio/m4a"},mov:{"Content-Type":"video/quicktime"},wmv:{"Content-Type":"video/x-ms-wmv"},mpeg:{"Content-Type":"video/mpeg"},wav:{"Content-Type":"audio/wav"},ogg:{"Content-Type":"audio/ogg"},ogv:{"Content-Type":"video/ogg"},oga:{"Content-Type":"audio/ogg"},opus:{"Content-Type":"audio/opus"}},T=globalThis.process,Nt=Symbol(),me=class extends Set{call(e,...n){var s;s=[];for(let o of g(this))s.push(o[e](...n));return s}close(e={}){var n;n=[];for(let s of g(this))n.push(s.close(e));return n}reload(e={}){var n;n=[];for(let s of g(this))n.push(s.reload(e));return n}broadcast(e,...n){var s;s=[];for(let o of g(this))s.push(o.broadcast(e,...n));return s}emit(e,n){var s;s=[];for(let o of g(this))s.push(o.emit(e,n));return s}},pe=me;(()=>{p(me,Nt,"Servers",0)})();var M=new pe,jt=Symbol(),N,An=new(N=class extends De.EventEmitter{constructor(){var e;super(...arguments),e=this,this.autoreload=!1,this.state={}}[Pt](){var e=this;if(this[He]!=!0&&(this[He]=!0,!0))return this.on("rebuild",function(n){let s=globalThis.IMBA_MANIFEST;return globalThis.IMBA_MANIFEST=n,M.broadcast("rebuild",n)}),this.on("reloading",function(n){var s;e.state.reloading=!0,s=[];for(let o of g(M))s.push(o.pause());return s}),this.on("reloaded",async function(n){var s;e.state.reloaded=!0,M.broadcast("reloaded"),await new Promise(function(r){return setTimeout(r,100)}),s=[];for(let r of g(M))s.push(r.close());let o=s;return setTimeout(function(){return T.exit(0)},100),await Promise.all(o),T.exit(0)}),!0}send(e){if(Pe(T.send,Function))return T.send(e)}on(e,n){return super.on(...arguments)}reload(){if(!(this.isReloading!=!0&&(this.isReloading=!0,!0)))return this;if(this.state.reloading=!0,!T.env.IMBA_SERVE){console.warn("not possible to gracefully reload servers not started via imba start");return}this.send("reload")}},(()=>{p(N,jt,"Process",24)})(),N);function je(t,e=[],n=0){let s=globalThis.IMBA_MANIFEST[t];if(e.indexOf(t)>=0)return e;if(s!=null&&s.imports)for(let o=0,r=g(s==null?void 0:s.imports),l=r.length;o<l;o++){let a=r[o];e.push(a),je(a,e,n+1)}return e}var Bt=Symbol(),ge=class{constructor(e,n,s={}){this.server=e,this.url=n,[this.pathname,this.query]=n.split("?"),this.ext=A.default.extname(this.pathname),this.headers={"Content-Type":"text/plain","Access-Control-Allow-Origin":"*","cache-control":"public, max-age=31536000"},Object.assign(this.headers,e.options.assetHeaders||{}),Object.assign(this.headers,Ne[this.ext.slice(1)]||{}),this.headers["max-age"]=864e5,s.imports&&e.options.preload!==!1&&(this.headers.Link=je(n).map(function(o){return"<"+o+">; rel=modulepreload; as=script"}).join(", ")),this.path=e.localPathForUrl(n)}respond(e,n){var s=this;return _.default.access(this.path,_.default.constants.R_OK,function(o){if(o)return n.writeHead(404,{}),n.end();try{if(s.server.options.setHeaders&&s.server.options.setHeaders(n,s.path),globalThis.BUN)return _.default.readFile(s.path,function(r,l){return n.writeHead(200,s.headers),n.end(l)});{let r=_.default.createReadStream(s.path);return n.writeHead(200,s.headers),r.pipe(n)}}catch{return n.writeHead(503,{}),n.end()}})}createReadStream(){return _.default.createReadStream(this.path)}pipe(e){return this.createReadStream().pipe(e)}},de=ge;(()=>{p(ge,Bt,"AssetResponder",16)})();var Ft=Symbol(),_e=class{static wrap(e,n={}){return new this(e,n)}localPathForUrl(e){var r;let n,s,o=e.replace(/\?.*$/,"");return(r=this.urlToLocalPathMap)[o]??(r[o]=(n=A.default.resolve(Re.publicPath,"."+o),s=_.default.existsSync(n)&&n,!s&&this.staticDir&&(n=A.default.resolve(this.staticDir,"."+o),s=_.default.existsSync(n)&&n),s))}headersForAsset(e){let n,s=A.default.extname(e);return n=Object.assign({"Content-Type":"text/plain","Access-Control-Allow-Origin":"*","cache-control":"public"},Ne[s.slice(1)]||{})}get manifest(){return globalThis.IMBA_MANIFEST||{}}constructor(e,n={}){var s=this;M.add(this),this.id=Math.random(),this.options=n,this.closed=!1,this.paused=!1,this.server=e,this.clients=new Set,this.stalledResponses=[],this.assetResponders={},this.urlToLocalPathMap={},this.publicExistsMap={},this.staticDir=globalThis.IMBA_STATICDIR||"",T.env.IMBA_PATH&&(this.devtoolsPath=A.default.resolve(T.env.IMBA_PATH,"hmr.js")),this.scheme=Pe(e,Me.default.Server)?"http":"https";let o=this.server._events.request,r=globalThis[Dt];e.off("request",o),o[Mt]=this,e.on("listening",function(){let l=s.server.address(),a=l.address;(a=="::"||a=="0.0.0.0")&&(a="localhost");let c=""+s.scheme+"://"+a+":"+l.port+"/";if(!T.env.IMBA_CLUSTER)return console.log("listening on "+c)}),this.handler=function(l,a){var $e;let c,u=l.constructor.name=="Http2ServerRequest",f=l.url;if(s.paused||s.closed)return a.statusCode=302,a.setHeader("Location",l.url),u||a.setHeader("Connection","close"),s.closed?(u&&l.stream.session.close(),a.end()):s.stalledResponses.push(a);let d=l.headers,I;u?I=d[":scheme"]+"://"+d[":authority"]:I=(l.connection.encrypted?"https":"http")+"://"+d.host;let L=s.manifest[f];if(L&&s.localPathForUrl(f))return(($e=s.assetResponders)[f]||($e[f]=new de(s,f,L))).respond(l,a);if((f.match(/\.[A-Z\d]{8}\./)||f.match(/\.\w{1,4}($|\?)/))&&(c=s.localPathForUrl(f)))try{let y=s.headersForAsset(c);if(n.setHeaders&&n.setHeaders(a,c),globalThis.BUN)return _.default.readFile(c,function(k,dt){return k?(a.writeHead(500,{}),a.write("Error getting the file: "+k)):(a.writeHead(200,y),a.end(dt))});{let k=_.default.createReadStream(c);return a.writeHead(200,y),k.pipe(a)}}catch{return a.writeHead(503,{}),a.end()}if(r){let y=new r.Location(l.url,I);return r.Document.create({location:y},function(){return o(l,a)})}else return o(l,a)},e.on("request",this.handler),e.on("close",function(){return console.log("server is closing!!!")})}broadcast(e,n={},s=this.clients){n=JSON.stringify(n);let o="data: "+n+`


`;for(let r of g(s))r.write("event: "+e+`
`),r.write(`id: imba
`),r.write(o);return this}pause(){return this.paused!=!0&&(this.paused=!0,!0)&&this.broadcast("paused"),this}resume(){if(this.paused!=!1&&(this.paused=!1,!0))return this.broadcast("resumed"),this.flushStalledResponses()}flushStalledResponses(){for(let e=0,n=g(this.stalledResponses),s=n.length;e<s;e++)n[e].end();return this.stalledResponses=[]}close(){var e=this;return this.pause(),new Promise(function(n){return e.closed=!0,e.server.close(n),e.flushStalledResponses()})}},he=_e;(()=>{p(_e,Ft,"Server",16)})();function Be(t,...e){return he.wrap(t,...e)}var lt=require("node:crypto");var E=m(require("express")),ne=m(require("path"));var Fe=m(require("fs"));function Kt(t){let e;return t&&((e=t.toIterable)?e.call(t):t)}function qt(t,e){var n;return typeof e=="string"?typeof t===e:(n=e[Symbol.hasInstance])==null?void 0:n.call(e,t)}function Ut(t,e,n=[""]){for(let s=0,o=Kt(n),r=o.length;s<r;s++){let l=o[s],a=t.indexOf(l);if(a>=0)return t.slice(0,a)+e+t.slice(a)}return t}var Lt=Symbol(),ve=class{constructor(e){this.src=e}get entry(){var e;return(e=globalThis.IMBA_MANIFEST)==null?void 0:e[this.src]}get url(){return this.entry?this.entry.url:this.src}get path(){return this.entry?this.entry.path:null}get body(){return this.path?Fe.default.readFileSync(this.path,"utf-8"):null}toString(){return this.url}},z=ve;(()=>{p(ve,Lt,"ImbaAsset",16)})();function Z(t){var n;let e;return(e=(n=globalThis.IMBA_MANIFEST)==null?void 0:n[t])?new z(t):t}var Vt=Symbol(),Te=class{constructor(e,n){this.text=e,this.refs=n}get body(){var e=this;let n=this.text.replace(/ASSET_REF_(\d+)/g,function(s,o){var a;let r,l=e.refs[o];return qt(l,z)?String(l):(r=(a=globalThis.IMBA_MANIFEST)==null?void 0:a[String(l)])?r.url:l});return globalThis.IMBA_HMR_PATH&&(n=Ut(n,"<script src='/__hmr__.js'><\/script>",["<!--$head$-->","<!--$body$-->","<html",""])),n}toString(){return this.body}},ye=Te;(()=>{p(Te,Vt,"HtmlAsset",16)})();function Ke(t,e){return new ye(t,e)}var qe=Z("*?css");var Ue=Z("entry:src/app/yoyth-connect.imba?web");var Wt=[qe,Ue],Le=Ke(`<html lang="en">

<head><!--$head$-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.css">
    <script src="https://cdn.jsdelivr.net/npm/easymde/dist/easymde.min.js"><\/script>
    <title>Yoyth Connect</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <!-- reference to the client script styles -->
    <link rel='stylesheet' href='ASSET_REF_0'>
</head>

<body><!--$body$-->
    <!-- reference to the client script -->
    <script type="module" src='ASSET_REF_1'><\/script>
</body>

</html>`,Wt);var ct=m(require("fs"));var we=m(require("moment"));var Je=require("uuid"),Ve=Symbol.for("#imba"),We={"ACK.user_login":Jt,"ACK.ping":zt,user_login:Zt,vipps_login:Gt};function j(t){if(We[t])return We[t]();console.error("no login message for "+t),i.init_errors.push("no login message for "+t)}function Jt(){console.log("set handle_ack_login");function t(e){console.log("handle_ack_login"),console.dir(e),i.identity=e.payload.data.identity,i.identity_data=e.payload,i.signedIn=!0;let n={message_data:{type:"get_user_settings"},identity_data:{identity:i.identity,to_identity:i.YOYTHUSERSERVERIDENTITY,from_identity:i.session_identity},payload:{}};return G(n)}return t}function zt(){console.log("set ack_ping");function t(e){return console.dir(e)}return t}function Zt(){return console.log("set login"),function(e){return console.log("handle_login"),i.sockets[i.main_connection].sendmsg(e)}}function Gt(){console.log("set vipps_login");function t(e){console.log("handle_vipps_login");let n=(0,Je.v4)().toString(),s="https://"+i.VIPPSAPI+"/access-management-1.0/access/oauth2/auth?client_id="+i.VIPPSCLIENT+"&response_type=code&scope=openid%20name%20email%20phoneNumber%20address%20birthDate&state="+n+"&redirect_uri="+i.VIPPSREDIRECT;console.log(s),console.log(n);let o={message_data:{type:"user_login"},payload:{vipps_key:n}};G(Se("user_login",{vipps_key:n},{})),(this&&this[Ve]||globalThis[Ve]).window.open(s,"yoythLogin","resizable,height=4000,width=800")}return t}var be=require("buffer"),Ge=m(require("pako"));var ze=Symbol.for("#imba"),Ze={receive_data:Qt,"ACK.get_bank_list":Xt,"ACK.get_bank_accounts_link":en,"ACK.get_user_settings":tn};function w(t){if(Ze[t])return Ze[t]();console.error("no receive message for "+t),i.init_errors.push("no receive message for "+t)}function Qt(){console.log("receeive data");function t(e){if(console.log("handle_receive_data"),console.dir(e),e.payload&&e.payload.data&&e.payload.data.photo){let n=be.Buffer.from(e.payload.data.photo,"base64"),s=Ge.default.inflate(n),o=new TextDecoder().decode(s),r=JSON.parse(o),l=be.Buffer.from(r).toString("base64");return console.log(n.length),console.log(s.length),console.log(o.length),i.photo=l,i.status=e.payload.data.camera_status,i.photo_id=e.payload.data.id,v()}}return t}function Xt(){console.log("set_list_of_banks");function t(e){return i.banklist=Y(e),console.log("aaaaaack banklist"),console.dir(e),v()}return t}function en(){console.log("set_get_accounts_link");function t(e){return console.log(Y(e)),Y(e).link&&(this&&this[ze]||globalThis[ze]).window.open(Y(e).link,"Bank approval","resizable,height=4000,width=800"),v()}return t}function tn(){console.log("set_get_accounts_link");function t(e){let n=Y(e);return Array.isArray(n)&&n.length>0&&n.forEach(function(s){return i.settings[s.yItem.yMetaData.yId].item=s,i.settings[s.yItem.yMetaData.yId].value=s.yItem.yContent}),v()}return t}var es=require("uuid"),Qe={send_message:nn,get_bank_list:sn,get_bank_accounts_link:an,log_user_events:rn,get_user_settings:on};function Q(t){if(Qe[t])return Qe[t]();console.error("no send message for "+t),i.init_errors.push("no send message for "+t)}function nn(){return console.log("send message"),function(e){return console.log("handle_login"),i.sockets[i.main_connection].sendmsg(e)}}function sn(){return console.log("get_list of banks meth"),function(e){return e.identity_data.identity=i.identity,e.identity_data.to_identity=i.YOYTHBANKIDENTITY,e.identity_data.from_identity=i.session_identity,console.log("get list of banks"),i.sockets[i.main_connection].sendmsg(e)}}function on(){return console.log("get_user_settings meth"),function(e){return console.log("get settings"),i.sockets[i.main_connection].sendmsg(e)}}function rn(){return console.log("send user log event"),function(e){return e.identity_data.identity=i.identity,e.identity_data.to_identity=i.YOYTHUSERSERVERIDENTITY,e.identity_data.from_identity=i.session_identity,console.log("log user event"),i.sockets[i.main_connection].sendmsg(e)}}function an(){return console.log("get_link of banks meth"),function(e){return e.identity_data.identity=i.identity,e.identity_data.to_identity=i.YOYTHBANKIDENTITY,e.identity_data.from_identity=i.session_identity,console.log("get link to bank"),i.sockets[i.main_connection].sendmsg(e),i.menuOpenΦ=!1,i.focus=i.focus_history.pop()}}var as=require("uuid"),Xe={"yoyth.lost_connection":ln};function et(t){if(Xe[t])return Xe[t]();console.error("no send message for "+t),i.init_errors.push("no send message for "+t)}function ln(){return function(e){return console.log("log system msg"),console.dir(e)}}var tt={"ACK.user_login":j("ACK.user_login"),"ACK.ping":j("ACK.ping"),user_login:j("user_login"),vipps_login:j("vipps_login"),send_to_subscriber:w("receive_data"),get_user_settings:Q("get_user_settings"),"ACK.subscribe":w("receive_data"),"ACK.login.anonymous":w("receive_data"),"ACK.get_bank_list":w("ACK.get_bank_list"),"ACK.get_user_settings":w("ACK.get_user_settings"),get_bank_list:Q("get_bank_list"),get_bank_accounts_link:Q("get_bank_accounts_link"),"ACK.get_bank_accounts_link":w("ACK.get_bank_accounts_link"),"yoyth.lost_connection":et("yoyth.lost_connection")},G=function(t){console.log("wwwwwwwwwwww"),console.dir(t);let e=B(t)||t;return e=="ACK"&&(e=t.message_data.type="ACK."+F(t)),e&&tt[e]?tt[e](t):(console.error("no message action for "+e+": msg"+t),i.errors.push["no message action for "+e+": msg"+t],console.dir(t))};var i={current_date:new Date,country:"no",main_connection:"yoyth",settings:{},settings_list:{clipboard_before:{edit:"md_editor",default:"Categories []/n"},clibboard_after:{edit:"md_editor"}},settings_element:"",init_errors:[],errors:[],new_dateΦ:!1,test:!1,menuOpenΦ:!1,menuFlipTs:0,menu:{menu_items:{}},banklist:[],signIn:!1,signedIn:!1,subscribe:!1,sockets:{},popUpData:{},source:{},requests:{},metrics:{},abtests:{},contents:{},dashboards:[],session_identity:"",identity:"",identity_data:{},last_ts:{},photo:"",status:"",photo_id:"",subscriptions_on_ws:{},cardsubscriptions:{},sitekey:"",sitekey_login:!1,server_private_keys:{},focus:"daily_focus",focus_history:[]};var cn=function(){return we.default.defaultFormat="YYYY-MM-DDTHH:mm:ss.SSSZ",(0,we.default)().format().trim()};function B(t){if(t&&t.message_data)return t.message_data.type}function nt(t){return t.message_data.type==="ACK"}function F(t){return t.message_data.original.type}function Y(t){return t.payload}function st(t){return t.message_data.request_data&&t.message_data.request_data.requestType&&t.message_data.request_data.requestType!="ERROR"}function Se(t,e,n){let s={message_data:{type:t,creator:i.YOYTHAPP,created:cn(),original:{type:t}},identity_data:e,payload:n};return{message_data:{type:t,original:{type:t}},payload:n,identity_data:e}}var un=require("ws"),xe={count:0},h=(0,E.default)(),fn=process.env.PORT||3e3,x,ee=!1,K=!1,ot,q=0,rt=0,te=0,pn=!1,X=[];function U(t){if(!ee&&t){X.push(t);return}if(X.length>0){for(let e=0,n=oe(X),s=n.length;e<s;e++){let o=n[e];console.dir(o),x.send(JSON.stringify(o))}X=[]}if(t)return console.dir(t),x.send(JSON.stringify(t))}function dn(t,e){let n;return t.startsWith("---")||t.startsWith("ssh")?n=t:n=ct.default.readFileSync(process.env[t]||t).toString("utf-8"),(0,lt.publicEncrypt)(n,Buffer.from(e,"utf-8"))}var Ie={message_data:{type:"server_login",creator:"yoyth_connect",request_data:{stream_id:"yoyth_connect"}},identity_data:{identity:process.env.YOYTHCONNECTID},payload:{yoyth_login_identity:process.env.YOYTHCONNECTID,yoyth_login_name:process.env.YOYTHAPP,yoyth_secret:dn(process.env.YOYTHIDSPUBLICKEY,process.env.YOYTHSECRET),yoyth_ids_public_key:process.env.YOYTHSECRET}},ut={message_data:{type:"ping",creator:"yoyth_connect",request_data:{stream_id:"yoyth_connect"},original:{type:"ping"}},identity_data:{identity:process.env.YOYTHCONNECTID},payload:{}},it={message_data:{type:"vipps_access_request",creator:"yoyth_connect",request_data:{stream_id:"web_server"}},identity_data:{identity:process.env.YOYTHCONNECTID,from_identity:process.env.YOYTHCONNECTID,to_identity:process.env.YOYTHIDSIDENTITY},payload:{query:{}}};console.dir(Ie);function ft(){return console.log(process.env.YOYTHWSADDRESS),x=new un(process.env.YOYTHWSADDRESS),x.on("open",function(){return ee=!0,console.log("open"),U(void 0)}),x.on("message",function(t){console.log(t);let e=JSON.parse(t);if(console.log(e),q=0,e.connection_id){if(ot&&!e.reidentify){console.log("send back"),U({connection_id:e.connection_id,reconnect_id:ot,identity:process.env.YOYTHCONNECTID});return}if(e.reconnected){console.log("reconnected"),K=!0;return}U(Ie)}if(e.message_data)if(nt(e)){if(F(e)===B(Ie))return st(e)?(K=!0,rt=0,console.log("connect to identity server ok")):(console.error("connect to identity server failed"),rt+=1,K=!1);if(F(e)===B(ut))return te-=1,console.log("ping ok")}else return console.log("what msg?"),console.dir(e)}),x.on("close",function(t){return console.error("close"),console.dir(t),q+=1,K=!1,ee=!1,at()}),x.on("error",function(t){return q+=1,console.log("error"),console.dir(t),K=!1,ee=!1,at()})}function at(){return setTimeout(function(){return console.log("waited! errors="+q),q>10&&(console.log("restart server"),pn=!0,process.exit(12),process.abort),console.log("try to establish connection"),ft()},1e3)}function pt(){return te+=1,U(ut),setTimeout(function(){if(console.log("Send ping if outstanding pings < 3: "+te),te>=3){console.log("restart server"),process.exit(12);return}return pt()},15e3)}ft();pt();var hn=E.default.json({limit:"1kb"});h.use("/v1/",E.default.static(ne.default.join((0,S.dirname)((0,S.resolve)("src/server.imba")),"../dist/public")));h.use("/vipps/",E.default.static(ne.default.join((0,S.dirname)((0,S.resolve)("src/server.imba")),"../dist/public")));h.use("/yoyth/",E.default.static(ne.default.join((0,S.dirname)((0,S.resolve)("src/server.imba")),"../dist/public")));h.post("/increment",hn,function(t,e){return xe.count+=t.body.increment,e.send({count:xe.count})});h.post("/justtesting",function(t,e){return console.dir(t),console.dir("body"),console.dir(t.body),e.send({body:t.body})});h.get("/count",function(t,e){return e.send({count:xe.count})});h.get("/yoythconfig",function(t,e){return console.log("addr",process.env.YOYTHWSADDRESS),e.send({YOYTHWSADDRESS:process.env.YOYTHWSADDRESS,VIPPSAPI:process.env.YOYTHVIPPSAPI,VIPPSCLIENT:process.env.YOYTHVIPPSCLIENT,VIPPSREDIRECT:process.env.YOYTHVIPPSREDIRECT,YOYTHANONYMID:process.env.YOYTHANONYMID,YOYTHBANKIDENTITY:process.env.YOYTHBANKIDENTITY,YOYTHUSERSERVERIDENTITY:process.env.YOYTHUSERSERVERIDENTITY,YOYTHAPP:process.env.YOYTHAPP,TESTUSER:process.env.TESTUSER})});h.get("/yoythvippsrequest",function(t,e){return console.log("vippsrequest"),console.dir(t.body),console.dir(t.query),e.send(),it.payload.query=t.query,U(it)});h.get("/yoyth-connect/apiadmin/ping",function(t,e){return e.send({ping:"OK"})});h.get(/.*/,function(t,e){return t.accepts(["image/*","html"])!="html"?e.sendStatus(404):e.send(Le.body)});Be(h.listen(fn));
//__FOOT__
