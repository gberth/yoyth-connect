globalThis.IMBA_MANIFEST={"entry:src/app/yoyth-connect.imba?web":{"url":"./assets/yoyth-connect.MNQ3FDHN.js","path":"/home/gunnar/yoyth/yoyth-connect/dist/public/assets/yoyth-connect.MNQ3FDHN.js"},"*?css":{"url":"./assets/index.LXIC4F6Z.css","path":"/home/gunnar/yoyth/yoyth-connect/dist/public/assets/index.LXIC4F6Z.css"},"./assets/yoyth-connect.MNQ3FDHN.js":{},"./assets/yoyth-connect.JFINNC2W.css":{},"./assets/index.LXIC4F6Z.css":{}};globalThis.IMBA_ASSETS_PATH='assets'
var se=Object.create;var L=Object.defineProperty;var re=Object.getOwnPropertyDescriptor;var ne=Object.getOwnPropertyNames;var ie=Object.getPrototypeOf,oe=Object.prototype.hasOwnProperty;var ae=(r,e,t,s)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of ne(e))!oe.call(r,n)&&n!==t&&L(r,n,{get:()=>e[n],enumerable:!(s=re(e,n))||s.enumerable});return r};var y=(r,e,t)=>(t=r!=null?se(ie(r)):{},ae(e||!r||!r.__esModule?L(t,"default",{value:r,enumerable:!0}):t,r));var d=require("path");var ye=require("cluster"),h=y(require("fs")),f=y(require("path")),W=require("events"),q=y(require("http")),Te=require("https");function c(r){let e;return r&&((e=r.toIterable)?e.call(r):r)}function C(r,e){Object.defineProperty(r,"name",{value:e,configurable:!0})}function K(r){var e,t;(t=(e=Object.getPrototypeOf(r.prototype).constructor)==null?void 0:e.inherited)==null||t.call(e,r)}var le=Symbol.for("#setup"),k=Symbol.for("#setup?"),ce=Symbol.for("#dom"),he=Symbol.for("#server"),J={html:{"Content-Type":"text/html; charset=utf-8"},js:{"Content-Type":"text/javascript; charset=utf-8"},cjs:{"Content-Type":"text/javascript; charset=utf-8"},mjs:{"Content-Type":"text/javascript; charset=utf-8"},json:{"Content-Type":"application/json; charset=utf-8"},css:{"Content-Type":"text/css; charset=utf-8"},map:{"Content-Type":"application/json; charset=utf-8"},otf:{"Content-Type":"font/otf"},ttf:{"Content-Type":"font/ttf"},woff:{"Content-Type":"font/woff"},woff2:{"Content-Type":"font/woff2"},svg:{"Content-Type":"image/svg+xml"},avif:{"Content-Type":"image/avif"},gif:{"Content-Type":"image/gif"},png:{"Content-Type":"image/png"},apng:{"Content-Type":"image/apng"},webp:{"Content-Type":"image/webp"},jpg:{"Content-Type":"image/jpeg"},jpeg:{"Content-Type":"image/jpeg"},ico:{"Content-Type":"image/x-icon"},bmp:{"Content-Type":"image/bmp"},pdf:{"Content-Type":"application/pdf"},webm:{"Content-Type":"video/webm"},weba:{"Content-Type":"audio/webm"},avi:{"Content-Type":"video/x-msvideo"},mp3:{"Content-Type":"audio/mpeg"},mp4:{"Content-Type":"video/mp4"},m4a:{"Content-Type":"audio/m4a"},mov:{"Content-Type":"video/quicktime"},wmv:{"Content-Type":"video/x-ms-wmv"},mpeg:{"Content-Type":"video/mpeg"},wav:{"Content-Type":"audio/wav"},ogg:{"Content-Type":"audio/ogg"},ogv:{"Content-Type":"video/ogg"},oga:{"Content-Type":"audio/ogg"},opus:{"Content-Type":"audio/opus"}},l=globalThis.process,w=class extends Set{call(e,...t){var s;s=[];for(let n of c(this))s.push(n[e](...t));return s}close(e={}){var t;t=[];for(let s of c(this))t.push(s.close(e));return t}reload(e={}){var t;t=[];for(let s of c(this))t.push(s.reload(e));return t}broadcast(e,...t){var s;s=[];for(let n of c(this))s.push(n.broadcast(e,...t));return s}emit(e,t){var s;s=[];for(let n of c(this))s.push(n.emit(e,t));return s}},R=w;(()=>{C(w,"Servers"),K(w)})();var _=new R,v,_e=new(v=class extends W.EventEmitter{constructor(){var e;super(...arguments),e=this,this.autoreload=!1,this.state={}}[le](){var e=this;if(this[k]!=!0&&(this[k]=!0,!0))return this.on("rebuild",function(t){let s=globalThis.IMBA_MANIFEST;return globalThis.IMBA_MANIFEST=t,_.broadcast("rebuild",t)}),this.on("reloading",function(t){var s;e.state.reloading=!0,s=[];for(let n of c(_))s.push(n.pause());return s}),this.on("reloaded",async function(t){var s;e.state.reloaded=!0,_.broadcast("reloaded"),await new Promise(function(o){return setTimeout(o,100)}),s=[];for(let o of c(_))s.push(o.close());let n=s;return setTimeout(function(){return l.exit(0)},100),await Promise.all(n),l.exit(0)}),!0}send(e){if(l.send instanceof Function)return l.send(e)}on(e,t){return super.on(...arguments)}reload(){if(!(this.isReloading!=!0&&(this.isReloading=!0,!0)))return this;if(this.state.reloading=!0,!l.env.IMBA_SERVE){console.warn("not possible to gracefully reload servers not started via imba start");return}this.send("reload")}},(()=>{C(v,"Process"),K(v)})(),v);function V(r,e=[],t=0){let s=globalThis.IMBA_MANIFEST[r];if(e.indexOf(r)>=0)return e;if(s!=null&&s.imports)for(let n=0,o=c(s==null?void 0:s.imports),a=o.length;n<a;n++){let i=o[n];e.push(i),V(i,e,t+1)}return e}var H=class{constructor(e,t,s={}){this.server=e,this.url=t,[this.pathname,this.query]=t.split("?"),this.ext=f.default.extname(this.pathname),this.headers={"Content-Type":"text/plain","Access-Control-Allow-Origin":"*","cache-control":"public, max-age=31536000"},Object.assign(this.headers,e.options.assetHeaders||{}),Object.assign(this.headers,J[this.ext.slice(1)]||{}),this.headers["max-age"]=864e5,s.imports&&e.options.preload!==!1&&(this.headers.Link=V(t).map(function(n){return"<"+n+">; rel=modulepreload; as=script"}).join(", ")),this.path=e.localPathForUrl(t)}respond(e,t){var s=this;return h.default.access(this.path,h.default.constants.R_OK,function(n){if(n)return t.writeHead(404,{}),t.end();try{if(s.server.options.setHeaders&&s.server.options.setHeaders(t,s.path),globalThis.BUN)return h.default.readFile(s.path,function(o,a){return t.writeHead(200,s.headers),t.end(a)});{let o=h.default.createReadStream(s.path);return t.writeHead(200,s.headers),o.pipe(t)}}catch{return t.writeHead(503,{}),t.end()}})}createReadStream(){return h.default.createReadStream(this.path)}pipe(e){return this.createReadStream().pipe(e)}},j=H;(()=>{C(H,"AssetResponder")})();var P=class{static wrap(e,t={}){return new this(e,t)}localPathForUrl(e){var o;let t,s,n=e.replace(/\?.*$/,"");return(o=this.urlToLocalPathMap)[n]??(o[n]=(t=f.default.resolve(this.publicPath,"."+n),s=h.default.existsSync(t)&&t,!s&&this.staticDir&&(t=f.default.resolve(this.staticDir,"."+n),s=h.default.existsSync(t)&&t),s))}headersForAsset(e){let t,s=f.default.extname(e);return t=Object.assign({"Content-Type":"text/plain","Access-Control-Allow-Origin":"*","cache-control":"public"},J[s.slice(1)]||{})}get manifest(){return globalThis.IMBA_MANIFEST||{}}constructor(e,t={}){var s=this;_.add(this),this.id=Math.random(),this.options=t,this.closed=!1,this.paused=!1,this.server=e,this.clients=new Set,this.stalledResponses=[],this.assetResponders={},this.urlToLocalPathMap={},this.publicExistsMap={};try{this.rootDir=l.env.IMBA_OUTDIR||f.default.dirname(l.env.pm_exec_path||l.argv[1])}catch{}try{this.publicPath=f.default.resolve(this.rootDir,l.env.IMBA_PUBDIR||globalThis.IMBA_PUBDIR||"public")}catch{}this.staticDir=globalThis.IMBA_STATICDIR||"",l.env.IMBA_PATH&&(this.devtoolsPath=f.default.resolve(l.env.IMBA_PATH,"dist","hmr.js")),this.scheme=e instanceof q.default.Server?"http":"https";let n=this.server._events.request,o=globalThis[ce];e.off("request",n),n[he]=this,e.on("listening",function(){let a=s.server.address(),i=a.address;(i=="::"||i=="0.0.0.0")&&(i="localhost");let g=""+s.scheme+"://"+i+":"+a.port+"/";if(!l.env.IMBA_CLUSTER)return console.log("listening on "+g)}),this.handler=function(a,i){var D;let g,S=a.constructor.name=="Http2ServerRequest",p=a.url;if(s.paused||s.closed)return i.statusCode=302,i.setHeader("Location",a.url),S||i.setHeader("Connection","close"),s.closed?(S&&a.stream.session.close(),i.end()):s.stalledResponses.push(i);let M=a.headers,I;S?I=M[":scheme"]+"://"+M[":authority"]:I=(a.connection.encrypted?"https":"http")+"://"+M.host;let U=s.manifest[p];if(U&&s.localPathForUrl(p))return((D=s.assetResponders)[p]||(D[p]=new j(s,p,U))).respond(a,i);if((p.match(/\.[A-Z\d]{8}\./)||p.match(/\.\w{1,4}($|\?)/))&&(g=s.localPathForUrl(p)))try{let u=s.headersForAsset(g);if(t.setHeaders&&t.setHeaders(i,g),globalThis.BUN)return h.default.readFile(g,function(b,te){return b?(i.writeHead(500,{}),i.write("Error getting the file: "+b)):(i.writeHead(200,u),i.end(te))});{let b=h.default.createReadStream(g);return i.writeHead(200,u),b.pipe(i)}}catch{return i.writeHead(503,{}),i.end()}if(o){let u=new o.Location(a.url,I);return o.Document.create({location:u},function(){return n(a,i)})}else return n(a,i)},e.on("request",this.handler),e.on("close",function(){return console.log("server is closing!!!")})}broadcast(e,t={},s=this.clients){t=JSON.stringify(t);let n="data: "+t+`


`;for(let o of c(s))o.write("event: "+e+`
`),o.write(`id: imba
`),o.write(n);return this}pause(){return this.paused!=!0&&(this.paused=!0,!0)&&this.broadcast("paused"),this}resume(){if(this.paused!=!1&&(this.paused=!1,!0))return this.broadcast("resumed"),this.flushStalledResponses()}flushStalledResponses(){for(let e=0,t=c(this.stalledResponses),s=t.length;e<s;e++)t[e].end();return this.stalledResponses=[]}close(){var e=this;return this.pause(),new Promise(function(t){return e.closed=!0,e.server.close(t),e.flushStalledResponses()})}},B=P;(()=>{C(P,"Server")})();function Y(r,...e){return B.wrap(r,...e)}var T=y(require("express")),A=y(require("path"));var z=y(require("fs"));function pe(r){let e;return r&&((e=r.toIterable)?e.call(r):r)}function Z(r,e){Object.defineProperty(r,"name",{value:e,configurable:!0})}function ue(r,e,t=[""]){for(let s=0,n=pe(t),o=n.length;s<o;s++){let a=n[s],i=r.indexOf(a);if(i>=0)return r.slice(0,i)+e+r.slice(i)}return r}var E=class{constructor(e){this.src=e}get entry(){var e;return(e=globalThis.IMBA_MANIFEST)==null?void 0:e[this.src]}get url(){return this.entry?this.entry.url:this.src}get path(){return this.entry?this.entry.path:null}get body(){return this.path?z.default.readFileSync(this.path,"utf-8"):null}toString(){return this.url}},$=E;(()=>{Z(E,"ImbaAsset")})();function x(r){var t;let e;return(e=(t=globalThis.IMBA_MANIFEST)==null?void 0:t[r])?new $(r):r}var O=class{constructor(e,t){this.text=e,this.refs=t}get body(){var e=this;let t=this.text.replace(/ASSET_REF_(\d+)/g,function(s,n){var i;let o,a=e.refs[n];return a instanceof $?String(a):(o=(i=globalThis.IMBA_MANIFEST)==null?void 0:i[String(a)])?o.url:a});return globalThis.IMBA_HMR_PATH&&(t=ue(t,"<script src='/__hmr__.js'><\/script>",["<!--$head$-->","<!--$body$-->","<html",""])),t}toString(){return this.body}},F=O;(()=>{Z(O,"HtmlAsset")})();function G(r,e){return new F(r,e)}var Q=x("*?css");var X=x("entry:src/app/yoyth-connect.imba?web");var fe=[Q,X],ee=G(`<html lang="en">

<head><!--$head$-->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css?family=Montserrat:100,200,300" rel="stylesheet" />

    <title>Yoyth Connect</title>
    <link rel="icon" type="image/x-icon" href="/images/favicon.ico">
    <!-- reference to the client script styles -->
    <link rel='stylesheet' href='ASSET_REF_0'>
</head>

<body><!--$body$-->
    <!-- reference to the client script -->
    <script type="module" src='ASSET_REF_1'><\/script>
</body>

</html>`,fe);var N={count:0},m=(0,T.default)(),de=process.env.PORT||3e3,me=T.default.json({limit:"1kb"});m.use("/v1/",T.default.static(A.default.join((0,d.dirname)((0,d.resolve)("src/server.imba")),"../dist/public")));m.use("/vipps/",T.default.static(A.default.join((0,d.dirname)((0,d.resolve)("src/server.imba")),"../dist/public")));m.use("/yoyth/",T.default.static(A.default.join((0,d.dirname)((0,d.resolve)("src/server.imba")),"../dist/public")));m.post("/increment",me,function(r,e){return N.count+=r.body.increment,e.send({count:N.count})});m.get("/count",function(r,e){return e.send({count:N.count})});m.get("/yoyth-connect/apiadmin/ping",function(r,e){return e.send({ping:"OK"})});m.get(/.*/,function(r,e){return r.accepts(["image/*","html"])!="html"?e.sendStatus(404):e.send(ee.body)});Y(m.listen(de));
//__FOOT__
